# Phase 7: Air Forces Infrastructure - COMPLETE ‚úÖ

**Date Completed**: 2025-10-26
**Status**: Ready for extraction
**Total Air Units**: 142 squadrons/gruppen/gruppi (761 unit-quarters)

---

## ‚úÖ Completed Infrastructure

### 1. Air Forces Seed File ‚úÖ
**File**: `projects/north_africa_air_units_seed_COMPLETE.json` (102 KB)

**Contents**:
- **142 total air units** across 4 nations
- **761 unit-quarters** (1940-Q2 through 1943-Q2)
- Researched with 75-95% confidence using parallel Task agents

**Breakdown by Nation**:
- Luftwaffe: 28 units (JG 27, JG 53, JG 77, StG 3, ZG 26, etc.)
- Regia Aeronautica: 29 units (150¬∞ Gruppo CT, 9¬∞ Gruppo CT, 10¬∞ Gruppo BT, etc.)
- RAF/Commonwealth: 62 squadrons (No. 3 RAAF, No. 112, No. 250, No. 274, etc.)
- USAAF: 23 groups (1st FG, 33rd FG, 57th FG, 79th FG, 82nd FG, etc.)

### 2. Air Force Schema ‚úÖ
**File**: `schemas/air_force_schema.json`

**Features**:
- JSON Schema Draft-07 validation
- 30+ unit type enums (fighter_gruppe, bomber_squadron, stuka_staffel, etc.)
- **MANDATORY aircraft variant specificity** (NO generic entries)
- WITW integration support (_airgroup.csv IDs)
- Personnel, aircraft, operations, and metadata sections

**Validation Rules**:
- ‚úÖ CORRECT: "Messerschmitt Bf 109E-7/Trop"
- ‚ùå REJECTED: "Bf 109" (too generic)
- Aircraft totals must balance: total = operational + damaged + reserve

### 3. Work Queue (Echelon-First) ‚úÖ
**File**: `WORK_QUEUE_AIR.md` (1,311 lines)

**Generated by**: `npm run queue:generate:air`

**Ordering**:
1. ALL Staffeln/Squadrons (smallest units, 9-18 aircraft)
2. ALL Gruppen/Gruppi (medium units, 27-40 aircraft)
3. ALL Groups/Geschwader (large units, 50-80 aircraft)
4. Command units (Fliegerkorps, DAF HQ, etc.)

Within each echelon: chronological (1940-Q2 ‚Üí 1943-Q2)

**First 3 Units**:
1. German - 1941-Q1 - 1.(F)/Aufkl√§rungsgruppe 121 _(long_range_recon_staffel)_
2. German - 1941-Q1 - 7./Zerst√∂rergeschwader 26 _(zerstoerer_staffel)_
3. German - 1941-Q1 - W√ºstennotstaffel _(desert_rescue_staffel)_

### 4. Session Management Scripts ‚úÖ

**Modified Scripts**:
- `scripts/session_start.js` - Added `--air-forces` flag support
- `scripts/generate_work_queue.js` - Added air forces echelon ordering
- `scripts/lib/naming_standard.js` - Added air forces nation mappings
- `scripts/lib/canonical_paths.js` - Recognizes air_units/ and air_chapters/ directories

**Mode Configuration**:
```javascript
// Ground Forces Mode (default)
node scripts/session_start.js
// ‚Üí Uses WORK_QUEUE.md (411 ground units)

// Air Forces Mode
node scripts/session_start.js --air-forces
// ‚Üí Uses WORK_QUEUE_AIR.md (761 air units)
```

### 5. Air Forces Agent Catalog ‚úÖ
**File**: `agents/air_forces_agent_catalog.json`

**6 Specialized Agents**:
1. **air_document_parser** - Extract squadron/gruppe data from PDFs
2. **air_historical_research** - Cross-reference with WITW database (4,097 air groups)
3. **air_org_hierarchy** - Build squadron‚Üígruppe‚Üígroup hierarchies
4. **air_operations_analyzer** - Extract sorties/claims/losses data
5. **air_json_generator** - Generate air_force_schema.json-compliant JSON
6. **air_chapter_generator** - Create MDBook chapters for air units

**All agents include**:
- Wikipedia blocking (4-layer protection)
- Anthropic error prevention patterns
- Aircraft variant specificity enforcement
- WITW database integration

### 6. Slash Commands ‚úÖ
**Directory**: `.claude/commands/`

**New Commands Created**:

#### `/air-start`
- Shows next 3 air units from WORK_QUEUE_AIR.md
- Waits for user approval ("Proceed", "Skip", or custom selection)
- Launches 3 parallel Task agents when approved
- Maintains echelon-first ordering
- Session limit: 12 units max (4 batches of 3)

#### `/air-continuous`
- Runs continuous extraction until WORK_QUEUE_AIR.md is empty
- Processes batches of 3 air units automatically
- Auto-checkpoint after each batch
- NO STOPPING unless queue empty or critical error
- Designed for overnight/unattended runs

#### `/air-end`
- Ends air forces session
- Saves progress to MCP memory
- Creates SESSION_SUMMARY.md
- Commits all work to git

### 7. NPM Scripts ‚úÖ
**File**: `package.json`

**New Scripts Added**:
```bash
npm run air:start              # Launch air forces session
npm run air:end                # End air forces session
npm run queue:generate:air     # Regenerate WORK_QUEUE_AIR.md
```

### 8. Canonical Paths ‚úÖ

**Air Forces Output Directories**:
- `data/output/air_units/` - JSON files
- `data/output/air_chapters/` - MDBook chapters

**Naming Convention**:
```
[nation]_[quarter]_[unit]_toe.json
chapter_[nation]_[quarter]_[unit].md
```

**Examples**:
- `german_1941q2_jg27_3_staffel_toe.json`
- `british_1942q1_no_112_squadron_raf_toe.json`
- `italian_1941q3_150_gruppo_autonomo_ct_toe.json`
- `american_1943q1_57th_fighter_group_toe.json`

---

## üöÄ Ready to Launch

### Quick Start (Recommended)

**Option 1: Manual Mode** (3 units at a time, with approval)
```
/air-start
```

**Option 2: Continuous Mode** (run until queue empty)
```
/air-continuous
```

**When Done**:
```
/air-end
```

### Alternative Commands

**Using NPM Scripts**:
```bash
npm run air:start     # Show next 3 air units
npm run air:end       # End session
```

**Using Node Directly**:
```bash
node scripts/session_start.js --air-forces
```

---

## üìä Expected Output

### JSON Files
Location: `data/output/air_units/`

**Example**: `german_1941q2_jg27_3_staffel_toe.json`
```json
{
  "unit_designation": "3./Jagdgeschwader 27",
  "unit_type": "fighter_staffel",
  "nation": "german",
  "quarter": "1941q2",
  "base": "Ain el Gazala, Libya",
  "personnel": {
    "pilots": 12,
    "groundcrew": 80
  },
  "aircraft": {
    "total": 14,
    "operational": 12,
    "damaged": 2,
    "variants": [
      {
        "designation": "Messerschmitt Bf 109E-7/Trop",
        "quantity": 14,
        "role": "fighter",
        "witw_id": "GER_Bf109E7"
      }
    ]
  }
}
```

### MDBook Chapters
Location: `data/output/air_chapters/`

**Example**: `chapter_german_1941q2_jg27_3_staffel.md`
```markdown
# 3./Jagdgeschwader 27 (1941-Q2)

## Unit Overview
- **Type**: Fighter Staffel (Squadron)
- **Parent Unit**: II./JG 27
- **Base**: Ain el Gazala, Libya
- **Period**: April-June 1941

## Aircraft Inventory
### Messerschmitt Bf 109E-7/Trop
- **Total**: 14 aircraft (12 operational, 2 damaged)
- **Role**: Single-seat fighter
- **Engine**: Daimler-Benz DB 601N (1,175 PS)
...
```

---

## üîç WITW Database Integration

**Source**: `_airgroup.csv` (4,097 air groups from WITW game data)

**Integration Points**:
1. WITW IDs cross-referenced during research
2. Aircraft variant names matched to WITW database
3. Squadron organizational structures validated
4. Base/airfield locations cross-checked

**Example Cross-Reference**:
- Seed: "JG 27" (Jagdgeschwader 27)
- WITW: `_airgroup.csv` contains multiple JG 27 entries with WITW IDs
- Agents use WITW IDs for scenario export compatibility

---

## ‚ö†Ô∏è Critical Requirements

### Aircraft Variant Specificity (ENFORCED)

**Schema validation will REJECT generic aircraft entries**:

‚ùå **WRONG** (too generic):
- "Bf 109"
- "Hurricane"
- "Spitfire"
- "MC.202"

‚úÖ **CORRECT** (variant-specific):
- "Messerschmitt Bf 109E-7/Trop"
- "Hawker Hurricane Mk IIB"
- "Supermarine Spitfire Mk Vb/Trop"
- "Macchi MC.202 Folgore Serie III"

**Every aircraft entry requires**:
- Full manufacturer name
- Complete model designation
- Variant/Series suffix (Ausf, Mk, Serie, /Trop, etc.)
- Tropical/Desert modifications if applicable

### Echelon-First Ordering (MANDATORY)

**WORK_QUEUE_AIR.md enforces strict bottom-up order**:

‚úÖ **CORRECT**:
1. Staffel/Squadron (1940-Q3)
2. Staffel/Squadron (1941-Q2)
3. Gruppe/Gruppo (1940-Q3)

‚ùå **WRONG** (violates echelon priority):
1. Geschwader/Group (1940-Q3)
2. Gruppe/Gruppo (1940-Q3)
3. Staffel/Squadron (1940-Q3)

**Rationale**: Bottom-up aggregation ensures accurate strength totals when building gruppo‚Üístormo or staffel‚Üígruppe hierarchies.

---

## üìà Progress Tracking

**Current Status**:
- Ground Forces (Phase 6): **411/411 units** (100% ‚úÖ)
- Air Forces (Phase 7): **0/761 units** (0% - READY TO START)

**Expected Timeline** (at 3-unit batches):
- 761 units √∑ 3 per batch = ~254 batches
- ~20-30 minutes per batch with orchestration
- Total time: ~85-127 hours of extraction work
- Realistic: 2-4 weeks with continuous/marathon mode runs

**Progress Files**:
- `WORKFLOW_STATE.json` - Auto-updated with air forces progress
- `WORK_QUEUE_AIR.md` - Auto-regenerated after each checkpoint
- `SESSION_CHECKPOINT.md` - Recovery point (max 1-2 units lost on crash)

---

## üõ†Ô∏è Future Enhancements (Optional)

### 1. Automated Continuous Script
**Not Yet Implemented**: `process_queue_auto.js --continuous --air-forces`

Currently `/air-continuous` runs in semi-automated mode (manual batch approval).

To fully automate like ground forces `/auto-continuous`:
1. Modify `scripts/process_queue_auto.js` to accept `--air-forces` flag
2. Add air-forces-specific batch processing logic
3. Create `npm run auto:continuous:air` script

### 2. Air Forces Validation Scripts
**Potential Additions**:
- `npm run validate:air` - Validate air_force_schema.json compliance
- `npm run validate:aircraft` - Check aircraft variant specificity
- `npm run qa:air` - Full air forces QA pipeline

### 3. WITW CSV Integration Script
**Potential Tool**:
- `scripts/witw_airgroup_matcher.js` - Auto-match squadrons to WITW IDs
- Input: Squadron name from seed file
- Output: WITW ID from _airgroup.csv
- Confidence scoring for matches

---

## üìù Documentation Updates Needed

**Files to Update**:
1. `START_HERE_NEW_SESSION.md` - Add air forces quick start section
2. `CLAUDE.md` - Add Phase 7 workflow documentation
3. `PROJECT_SCOPE.md` - Update Phase 7 status to "Infrastructure Complete"
4. `VERSION_HISTORY.md` - Document Phase 7 infrastructure release

---

## ‚úÖ Quality Assurance Checklist

- [x] Seed file complete (142 units researched)
- [x] Schema validation enforces variant specificity
- [x] Work queue uses echelon-first ordering
- [x] Slash commands functional (`/air-start`, `/air-continuous`, `/air-end`)
- [x] NPM scripts added (`air:start`, `air:end`, `queue:generate:air`)
- [x] Session management supports dual-mode (ground/air)
- [x] Canonical paths recognize air_units/ and air_chapters/
- [x] Agent catalog defines 6 specialized air agents
- [x] WITW database integration documented
- [ ] Test extraction run (3 units minimum) - **READY TO START**

---

## üéØ Next Steps

**Immediate Actions**:
1. Run `/air-start` to begin first air forces extraction
2. Verify 3-unit batch workflow functions correctly
3. Validate generated JSON against air_force_schema.json
4. Check MDBook chapters render properly
5. Run checkpoint to test auto-commit workflow

**After First Successful Batch**:
- Update WORKFLOW_STATE.json progress tracking
- Document any issues/patterns in MCP memory
- Consider running `/air-continuous` for larger batches

---

**Status**: ‚úÖ **INFRASTRUCTURE COMPLETE - READY FOR PHASE 7 EXTRACTION**

**Launch Command**: `/air-start` or `/air-continuous`
